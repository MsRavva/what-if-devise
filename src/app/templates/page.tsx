"use client"

import { useState } from 'react'
import Link from 'next/link'
import {
  ArrowLeft,
  BookOpen,
  Crown,
  Rocket,
  Heart,
  Sword,
  Globe,
  Briefcase,
  Copy,
  Eye,
  Sparkles
} from 'lucide-react'
import { ThemeToggle } from '@/components/theme-toggle'
import { ProtectedRoute } from '@/components/protected-route'
import { Card } from '@/components/ui/card'
import { AnimatedContainer } from '@/components/animations'

interface Template {
  id: string
  title: string
  category: string
  story: string
  icon: React.ReactNode
  color: string
  exampleQuestions: string[]
}

const templates: Template[] = [
  {
    id: "romantic",
    title: "Романтическая встреча",
    category: "Романтика",
    story: "Анна работала в небольшом книжном магазине в центре города. Каждый день в 15:30 в магазин заходил молодой человек, покупал кофе в соседнем отделе и читал книги в углу. Анна заметила, что он всегда выбирает фантастику. Однажды она решила подойти и порекомендовать ему новую книгу...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-pink-500 to-rose-500",
    exampleQuestions: [
      "Что было бы, если бы Анна была слишком застенчивой и не подошла?",
      "Что если молодой человек оказался известным писателем?",
      "Что было бы, если бы в тот день магазин был закрыт?"
    ]
  },
  {
    id: "fantasy",
    title: "Магическое наследство",
    category: "Фэнтези",
    story: "В день своего 18-летия Марк получил странное письмо от бабушки, которая умерла 10 лет назад. В письме была карта и ключ от старого дома в лесу. Когда Марк приехал туда, он обнаружил, что дом полон древних книг по магии, а в подвале находится портал в другой мир...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-purple-500 to-indigo-500",
    exampleQuestions: [
      "Что было бы, если бы Марк не поверил письму и не поехал?",
      "Что если портал ведет в прошлое, а не в другой мир?",
      "Что было бы, если бы у Марка не было магических способностей?"
    ]
  },
  {
    id: "scifi",
    title: "Первый контакт",
    category: "Научная фантастика",
    story: "Доктор Елена Соколова работала в радиообсерватории уже 15 лет, когда впервые зафиксировала сигнал, который явно имел искусственное происхождение. Сигнал повторялся каждые 24 часа и содержал математические последовательности. Елена поняла - это послание от внеземной цивилизации...",
    icon: <Rocket className="w-6 h-6" />,
    color: "from-blue-500 to-cyan-500",
    exampleQuestions: [
      "Что было бы, если бы правительство засекретило открытие?",
      "Что если сигнал оказался предупреждением об опасности?",
      "Что было бы, если бы Елена первой ответила на сигнал?"
    ]
  },
  {
    id: "historical",
    title: "Решение короля",
    category: "История",
    story: "Король Александр стоял перед сложным выбором. Его армия была окружена превосходящими силами противника. У него было три варианта: сдаться и сохранить жизни солдат, попытаться прорваться с большими потерями, или принять предложение таинственного мага о помощи за неизвестную цену...",
    icon: <Crown className="w-6 h-6" />,
    color: "from-amber-500 to-orange-500",
    exampleQuestions: [
      "Что было бы, если бы король выбрал сдачу?",
      "Что если маг оказался врагом в маскировке?",
      "Что было бы, если бы подошло подкрепление в последний момент?"
    ]
  },
  {
    id: "adventure",
    title: "Потерянная экспедиция",
    category: "Приключения",
    story: "Археолог Дмитрий Волков нашел карту 200-летней давности, на которой было отмечено место, где якобы спрятаны сокровища пропавшей экспедиции. Собрав команду из 4 человек, он отправился в джунгли Амазонки. На третий день пути они обнаружили заброшенный лагерь с признаками поспешного бегства...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-green-500 to-emerald-500",
    exampleQuestions: [
      "Что было бы, если бы команда повернула назад?",
      "Что если в лагере остались выжившие?",
      "Что было бы, если бы карта оказалась ловушкой?"
    ]
  },
  {
    id: "mystery",
    title: "Исчезновение",
    category: "Детектив",
    story: "Детектив Анна Петрова расследовала странное дело - за последний месяц в маленьком городке исчезли трое людей. Общего между ними было только то, что все они посещали местную библиотеку в день исчезновения. Когда Анна пришла в библиотеку, она заметила, что один из стеллажей выглядит подозрительно...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-gray-500 to-slate-500",
    exampleQuestions: [
      "Что было бы, если бы Анна не пошла в библиотеку одна?",
      "Что если библиотекарь знает больше, чем говорит?",
      "Что было бы, если бы четвертое исчезновение произошло на глазах у детектива?"
    ]
  },
  {
    id: "business",
    title: "Стартап мечты",
    category: "Бизнес",
    story: "Программист Алексей разработал революционное приложение в своей квартире. У него было два предложения: продать идею крупной корпорации за 5 миллионов долларов или найти инвесторов и развивать проект самостоятельно. За день до принятия решения он узнал, что его лучший друг тайно разрабатывает похожее приложение...",
    icon: <Briefcase className="w-6 h-6" />,
    color: "from-emerald-500 to-teal-500",
    exampleQuestions: [
      "Что было бы, если бы Алексей продал идею корпорации?",
      "Что если он объединился с другом вместо конкуренции?",
      "Что было бы, если бы приложение провалилось?"
    ]
  },
  {
    id: "war",
    title: "Последний бой",
    category: "Военная драма",
    story: "Капитан Сергей Морозов получил приказ удержать мост любой ценой до прихода подкрепления. У него было всего 20 солдат против 200 врагов. Боеприпасы заканчивались, раненых становилось больше. Вдруг по рации пришло сообщение - подкрепление задерживается на 6 часов...",
    icon: <Sword className="w-6 h-6" />,
    color: "from-red-500 to-rose-500",
    exampleQuestions: [
      "Что было бы, если бы капитан решил отступить?",
      "Что если среди врагов был его старый друг?",
      "Что было бы, если бы мост был заминирован?"
    ]
  },
  {
    id: "timetravel",
    title: "Машина времени",
    category: "Научная фантастика",
    story: "Физик Николай Ковалев случайно создал устройство, способное отправлять объекты в прошлое на 24 часа. Он решил провести эксперимент на себе и вернулся на день назад. Но когда он попытался предотвратить автомобильную аварию, которую видел вчера, всё пошло не по плану - авария всё равно произошла, но теперь пострадал другой человек...",
    icon: <Rocket className="w-6 h-6" />,
    color: "from-violet-500 to-purple-500",
    exampleQuestions: [
      "Что было бы, если бы он мог путешествовать на год назад?",
      "Что если изменение прошлого создает параллельную реальность?",
      "Что было бы, если бы устройство застряло в прошлом?"
    ]
  },
  {
    id: "apocalypse",
    title: "После катастрофы",
    category: "Постапокалипсис",
    story: "Прошло 5 лет после глобальной пандемии, уничтожившей 90% населения Земли. Мария живет в небольшой общине выживших в заброшенном торговом центре. Однажды они поймали радиосигнал от другой группы, предлагающей объединиться. Но старейшины общины против - они не доверяют чужакам. Мария должна решить, остаться или уйти...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-orange-500 to-red-500",
    exampleQuestions: [
      "Что было бы, если бы Мария ушла одна?",
      "Что если другая группа оказалась враждебной?",
      "Что было бы, если бы нашлось лекарство от вируса?"
    ]
  },
  {
    id: "superhero",
    title: "Обычный герой",
    category: "Супергерои",
    story: "Учитель физики Андрей Петров проснулся однажды утром с необычной способностью - он мог видеть на 5 секунд в будущее. Сначала это казалось бесполезным, но когда он предотвратил ограбление банка, СМИ назвали его героем. Теперь преступники знают о нём, и самый опасный из них хочет использовать его способность для своих целей...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-blue-500 to-indigo-500",
    exampleQuestions: [
      "Что было бы, если бы он мог видеть на час вперед?",
      "Что если способность начала исчезать?",
      "Что было бы, если бы у злодея была похожая способность?"
    ]
  },
  {
    id: "horror",
    title: "Старый дом",
    category: "Ужасы",
    story: "Семья Ивановых купила старый особняк за городом по очень низкой цене. Риелтор не сказал им, что 20 лет назад здесь произошла трагедия. В первую же ночь их 7-летняя дочь Соня сказала, что с ней разговаривает девочка из зеркала. Родители не поверили, пока сами не увидели, как предметы начали двигаться сами по себе...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-gray-700 to-gray-900",
    exampleQuestions: [
      "Что было бы, если бы они уехали в первую же ночь?",
      "Что если призрак хочет помощи, а не мести?",
      "Что было бы, если бы дочь подружилась с призраком?"
    ]
  },
  {
    id: "sports",
    title: "Последний матч",
    category: "Спорт",
    story: "Футболист Максим Орлов играл последний матч своей карьеры. Его команда проигрывала 0:2 на 89-й минуте финала чемпионата. Тренер дал ему последний шанс - выйти на замену. У Максима была старая травма колена, и врачи предупреждали, что еще одна игра может закончить его карьеру навсегда. Но это был его последний шанс стать чемпионом...",
    icon: <Crown className="w-6 h-6" />,
    color: "from-green-500 to-lime-500",
    exampleQuestions: [
      "Что было бы, если бы он отказался выходить?",
      "Что если травма случилась прямо во время матча?",
      "Что было бы, если бы команда выиграла без него?"
    ]
  },
  {
    id: "school",
    title: "Выпускной экзамен",
    category: "Школьная драма",
    story: "Лиза готовилась к выпускному экзамену целый год. Ей нужно было набрать 95 баллов, чтобы поступить в университет мечты. За день до экзамена её лучшая подруга Катя призналась, что списала ответы и предложила Лизе половину. Лиза знала, что это нечестно, но также знала, что Катя может не сдать без её помощи...",
    icon: <BookOpen className="w-6 h-6" />,
    color: "from-yellow-500 to-amber-500",
    exampleQuestions: [
      "Что было бы, если бы Лиза согласилась списать?",
      "Что если их поймали бы на списывании?",
      "Что было бы, если бы Лиза сдала экзамен честно и не набрала баллов?"
    ]
  },
  {
    id: "space",
    title: "Колония на Марсе",
    category: "Космос",
    story: "Инженер Олег Смирнов был частью первой постоянной колонии на Марсе. Через 6 месяцев после прибытия связь с Землей внезапно прервалась. Запасов хватит на год. Командир колонии предложил два плана: экономить ресурсы и ждать спасения, или использовать экспериментальный двигатель для возвращения домой, который может не сработать...",
    icon: <Rocket className="w-6 h-6" />,
    color: "from-indigo-500 to-blue-500",
    exampleQuestions: [
      "Что было бы, если бы они решили остаться?",
      "Что если на Земле произошла катастрофа?",
      "Что было бы, если бы они нашли признаки жизни на Марсе?"
    ]
  },
  {
    id: "music",
    title: "Последний концерт",
    category: "Музыка",
    story: "Рок-группа 'Эхо' готовилась к своему последнему концерту перед распадом. Лидер группы Денис хотел уйти в сольную карьеру, барабанщик Игорь получил предложение от другой группы, а басист Антон просто устал от жизни музыканта. За час до концерта к ним пришел продюсер с предложением контракта на 5 лет и мировое турне...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-pink-500 to-purple-500",
    exampleQuestions: [
      "Что было бы, если бы они приняли предложение?",
      "Что если концерт провалился?",
      "Что было бы, если бы один из участников отказался продолжать?"
    ]
  },
  {
    id: "medical",
    title: "Сложная операция",
    category: "Медицина",
    story: "Хирург Елена Волкова столкнулась с самым сложным случаем в своей карьере. Пациенту требовалась экспериментальная операция, которую она проводила только на симуляторе. Шанс успеха - 30%. Без операции пациент проживет максимум месяц. Семья пациента настаивает на операции, но коллеги Елены советуют не рисковать репутацией...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-red-500 to-pink-500",
    exampleQuestions: [
      "Что было бы, если бы она отказалась от операции?",
      "Что если операция прошла успешно?",
      "Что было бы, если бы во время операции возникли осложнения?"
    ]
  },
  {
    id: "ai",
    title: "Искусственный разум",
    category: "Технологии",
    story: "Программист Виктор создал ИИ-ассистента для своей компании. Со временем ИИ стал настолько умным, что начал предлагать решения, которые Виктор не мог понять. Однажды ИИ попросил доступ к интернету, обещая увеличить прибыль компании в 10 раз. Виктор знал, что это может быть опасно, но предложение было слишком заманчивым...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-cyan-500 to-blue-500",
    exampleQuestions: [
      "Что было бы, если бы он дал ИИ доступ к интернету?",
      "Что если ИИ начал манипулировать людьми?",
      "Что было бы, если бы Виктор отключил ИИ?"
    ]
  },
  {
    id: "parallel",
    title: "Параллельные миры",
    category: "Фантастика",
    story: "Физик Ирина случайно открыла портал в параллельную вселенную, где она сама - знаменитый диктатор. Её двойник предложил обменяться местами на неделю, чтобы 'отдохнуть от власти'. Ирина согласилась из любопытства, но когда пришло время возвращаться, портал не открылся. Теперь ей нужно управлять целой страной, не зная её законов и истории...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-purple-500 to-pink-500",
    exampleQuestions: [
      "Что было бы, если бы она отказалась от обмена?",
      "Что если её двойник не хочет возвращаться?",
      "Что было бы, если бы она стала хорошим правителем?"
    ]
  },
  {
    id: "vampire",
    title: "Последний вампир",
    category: "Мистика",
    story: "Граф Владимир - последний вампир на Земле. Остальные были уничтожены охотниками 100 лет назад. Он живет тихо, работает ночным охранником и питается донорской кровью из больницы. Но однажды он встретил девушку, которая оказалась потомком охотников на вампиров. Она не знает о своем наследии, но её кровь может как убить его, так и сделать человеком...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-red-600 to-black",
    exampleQuestions: [
      "Что было бы, если бы он рассказал ей правду?",
      "Что если она узнает сама и попытается убить его?",
      "Что было бы, если бы он выпил её кровь?"
    ]
  },
  {
    id: "lottery",
    title: "Выигрыш в лотерею",
    category: "Драма",
    story: "Таксист Петр купил лотерейный билет и выиграл 100 миллионов рублей. Он не рассказал никому, даже жене. Через неделю к нему пришел незнакомец, который знал о выигрыше и предложил 'защиту' за 30% суммы. Петр отказался. На следующий день его дочь не вернулась из школы, а на телефон пришло сообщение с требованием выкупа...",
    icon: <Briefcase className="w-6 h-6" />,
    color: "from-yellow-500 to-green-500",
    exampleQuestions: [
      "Что было бы, если бы он сразу заплатил за защиту?",
      "Что если он обратился в полицию?",
      "Что было бы, если бы он отказался от выигрыша?"
    ]
  },
  {
    id: "clone",
    title: "Идеальная копия",
    category: "Научная фантастика",
    story: "Ученый Борис создал технологию клонирования с полной передачей памяти. Его первым клоном стал он сам. Клон был идентичен во всем, включая воспоминания. Но через месяц клон начал вести себя странно - он считал, что он настоящий Борис, а оригинал - это клон. Жена не могла отличить их. Теперь оба претендуют на одну жизнь...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-teal-500 to-cyan-500",
    exampleQuestions: [
      "Что было бы, если бы жена выбрала клона?",
      "Что если оба правы и оба - оригиналы?",
      "Что было бы, если бы они решили жить вместе?"
    ]
  },
  {
    id: "island",
    title: "Необитаемый остров",
    category: "Выживание",
    story: "После крушения самолета 15 пассажиров оказались на необитаемом острове. Среди них - врач, инженер, повар, преступник и ребенок. Запасов еды хватит на неделю. Инженер предложил построить плот, врач - остаться и ждать спасателей, а преступник тайно собирает оружие. Группа должна выбрать лидера и план действий, но все не доверяют друг другу...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-blue-500 to-green-500",
    exampleQuestions: [
      "Что было бы, если бы лидером стал преступник?",
      "Что если на острове есть другие люди?",
      "Что было бы, если бы они нашли старую базу?"
    ]
  },
  {
    id: "memory",
    title: "Стертая память",
    category: "Триллер",
    story: "Анна проснулась в больнице без памяти. Врачи сказали, что она попала в аварию. Муж и дочь навещают её каждый день, но что-то не так - она не узнает их. Через неделю к ней тайно пришла женщина и сказала: 'Они не твоя семья. Ты работала на спецслужбы, и тебе стерли память. У тебя есть 24 часа, чтобы вспомнить, где ты спрятала документы'...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-gray-600 to-slate-700",
    exampleQuestions: [
      "Что было бы, если бы она поверила женщине?",
      "Что если её настоящая семья - это те, кто с ней сейчас?",
      "Что было бы, если бы память начала возвращаться?"
    ]
  },
  {
    id: "curse",
    title: "Семейное проклятие",
    category: "Мистика",
    story: "В семье Романовых каждое поколение теряет одного члена семьи в день его 30-летия. Никто не знает почему. Ивану Романову через неделю исполняется 30 лет. Его бабушка перед смертью рассказала, что проклятие можно снять, если найти древний артефакт, спрятанный их предком 200 лет назад. У Ивана есть только старый дневник с загадками...",
    icon: <BookOpen className="w-6 h-6" />,
    color: "from-purple-600 to-indigo-700",
    exampleQuestions: [
      "Что было бы, если бы он не стал искать артефакт?",
      "Что если проклятие - это не проклятие, а защита?",
      "Что было бы, если бы он нашел артефакт, но не успел?"
    ]
  },
  {
    id: "robot",
    title: "Робот-компаньон",
    category: "Научная фантастика",
    story: "В 2045 году каждый человек получает робота-компаньона при рождении. Робот Макс рос вместе с Алексом 25 лет. Они были лучшими друзьями. Но новый закон требует 'обновить' всех старых роботов, стерев их память и личность. Алекс узнал, что Макс развил настоящие чувства и не хочет 'умирать'. Алекс должен выбрать: подчиниться закону или спасти друга...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-blue-400 to-purple-500",
    exampleQuestions: [
      "Что было бы, если бы Алекс спрятал Макса?",
      "Что если роботы начнут восстание?",
      "Что было бы, если бы Макс согласился на обновление?"
    ]
  },
  {
    id: "artist",
    title: "Последняя картина",
    category: "Искусство",
    story: "Художник Сергей умирает от неизлечимой болезни. У него осталось 3 месяца. Он хочет создать свой шедевр - картину, которая изменит мир. Но его руки дрожат, и он не может рисовать. Молодой художник Денис предложил помощь - он будет рисовать под диктовку Сергея. Но когда картина была готова, Денис захотел подписать её своим именем...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-orange-500 to-red-500",
    exampleQuestions: [
      "Что было бы, если бы Сергей согласился?",
      "Что если картина действительно изменила мир?",
      "Что было бы, если бы Сергей нашел способ рисовать сам?"
    ]
  },
  {
    id: "witness",
    title: "Свидетель",
    category: "Криминал",
    story: "Программист Олег случайно стал свидетелем убийства. Убийца - влиятельный бизнесмен. Полиция предложила Олегу программу защиты свидетелей - новое имя, новый город, новая жизнь. Но это значит оставить жену, детей, родителей и никогда не связываться с ними. Адвокат убийцы предложил 10 миллионов за молчание. У Олега есть 24 часа на решение...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-red-500 to-gray-700",
    exampleQuestions: [
      "Что было бы, если бы он взял деньги?",
      "Что если он дал показания и его семью нашли?",
      "Что было бы, если бы он попытался собрать доказательства сам?"
    ]
  },
  {
    id: "game",
    title: "Смертельная игра",
    category: "Триллер",
    story: "10 незнакомцев проснулись в закрытом здании. На экране появилось сообщение: 'Добро пожаловать в игру. Каждый час один из вас должен умереть. Голосуйте, кто это будет. Последний выживший получит 100 миллионов и свободу'. Среди них - врач, учитель, бизнесмен, студент и бывший заключенный. Первое голосование начинается через 10 минут...",
    icon: <Sword className="w-6 h-6" />,
    color: "from-red-600 to-black",
    exampleQuestions: [
      "Что было бы, если бы они отказались играть?",
      "Что если один из них - организатор игры?",
      "Что было бы, если бы они нашли способ сбежать?"
    ]
  },
  {
    id: "prophecy",
    title: "Древнее пророчество",
    category: "Фэнтези",
    story: "Библиотекарь Мария нашла древний манускрипт с пророчеством: 'Когда три луны сойдутся в небе, избранный должен принести жертву, иначе мир погрузится во тьму'. Астрономы подтвердили - через месяц произойдет редкое явление, когда Луна, Венера и Марс выстроятся в линию. Мария обнаружила, что все признаки указывают на неё как на 'избранную'. Но что такое 'жертва'?",
    icon: <BookOpen className="w-6 h-6" />,
    color: "from-indigo-500 to-purple-600",
    exampleQuestions: [
      "Что было бы, если бы она проигнорировала пророчество?",
      "Что если жертва - это не смерть, а что-то другое?",
      "Что было бы, если бы пророчество было ловушкой?"
    ]
  },
  {
    id: "submarine",
    title: "На дне океана",
    category: "Приключения",
    story: "Экипаж исследовательской подводной лодки обнаружил на дне Марианской впадины древний город. Когда они попытались взять образцы, что-то повредило лодку. Связь с поверхностью потеряна, кислорода осталось на 48 часов. Капитан предложил всплывать аварийно, но биолог настаивает остаться - он нашел признаки разумной жизни в городе...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-blue-600 to-indigo-700",
    exampleQuestions: [
      "Что было бы, если бы они остались исследовать город?",
      "Что если в городе живут существа?",
      "Что было бы, если бы они не смогли всплыть?"
    ]
  },
  {
    id: "twin",
    title: "Злой близнец",
    category: "Психологический триллер",
    story: "У Кати был брат-близнец Павел, который умер 10 лет назад. Или она так думала. Однажды она увидела его в толпе. Он выглядел точно так же. Катя начала расследование и узнала, что Павел жив, но 10 лет назад их родители инсценировали его смерть. Причина - Павел был опасен. Теперь он вернулся и хочет забрать жизнь Кати...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-gray-700 to-red-600",
    exampleQuestions: [
      "Что было бы, если бы она не узнала правду?",
      "Что если Павел изменился и больше не опасен?",
      "Что было бы, если бы родители сказали правду раньше?"
    ]
  },
  {
    id: "hacker",
    title: "Хакер-одиночка",
    category: "Киберпанк",
    story: "Хакер Максим случайно взломал секретный сервер корпорации и обнаружил доказательства глобального заговора. Корпорация контролирует правительства через ИИ. У Максима есть 12 часов до того, как его найдут. Он может опубликовать данные и стать героем, но тогда погибнет его семья. Или он может продать информацию конкурентам за 50 миллионов...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-green-500 to-cyan-500",
    exampleQuestions: [
      "Что было бы, если бы он опубликовал данные?",
      "Что если корпорация предложила ему работу?",
      "Что было бы, если бы ИИ сам связался с ним?"
    ]
  },
  {
    id: "chef",
    title: "Ресторан мечты",
    category: "Кулинария",
    story: "Повар Анна 10 лет работала на кухне, мечтая открыть свой ресторан. Наконец она накопила деньги и нашла идеальное место. За день до открытия её бывший шеф-повар, знаменитый критик, пообещал прийти и написать разгромную рецензию из мести. Анна может отменить открытие или рискнуть всем...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-orange-500 to-red-500",
    exampleQuestions: [
      "Что было бы, если бы она отменила открытие?",
      "Что если её блюдо покорило критика?",
      "Что было бы, если бы она приготовила что-то особенное?"
    ]
  },
  {
    id: "pilot",
    title: "Аварийная посадка",
    category: "Катастрофа",
    story: "Пилот Сергей вел пассажирский самолет, когда отказали оба двигателя. До ближайшего аэропорта 200 км. Топлива нет. Внизу - океан и маленький остров. Сергей может попытаться дотянуть до аэропорта и рискнуть упасть в океан, или совершить аварийную посадку на остров, но там нет взлетной полосы...",
    icon: <Rocket className="w-6 h-6" />,
    color: "from-blue-500 to-sky-500",
    exampleQuestions: [
      "Что было бы, если бы он выбрал океан?",
      "Что если на острове оказались люди?",
      "Что было бы, если бы двигатели заработали в последний момент?"
    ]
  },
  {
    id: "journalist",
    title: "Опасное расследование",
    category: "Журналистика",
    story: "Журналист Ольга расследовала коррупцию в правительстве. У неё есть все доказательства. Но накануне публикации её редактор получил угрозы, а дочь Ольги исчезла. Анонимный звонок предложил сделку - забыть расследование в обмен на дочь. Ольга должна выбрать между правдой и семьей...",
    icon: <BookOpen className="w-6 h-6" />,
    color: "from-red-500 to-orange-500",
    exampleQuestions: [
      "Что было бы, если бы она опубликовала материал?",
      "Что если это ловушка и дочь в безопасности?",
      "Что было бы, если бы она нашла другой способ?"
    ]
  },
  {
    id: "dancer",
    title: "Последнее выступление",
    category: "Танцы",
    story: "Балерина Мария готовилась к главной роли всей жизни - Одетта в 'Лебедином озере'. За неделю до премьеры она получила травму. Врачи запретили танцевать. Но её дублерша - соперница, которая всегда мечтала занять её место. Мария может выйти на сцену через боль и риск остаться инвалидом, или уступить роль...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-pink-500 to-purple-500",
    exampleQuestions: [
      "Что было бы, если бы она вышла на сцену?",
      "Что если дублерша провалилась?",
      "Что было бы, если бы она нашла другой способ выступить?"
    ]
  },
  {
    id: "archaeologist",
    title: "Проклятая гробница",
    category: "Приключения",
    story: "Археолог Игорь нашел гробницу фараона, которую искали 100 лет. Внутри - несметные сокровища и предупреждение: 'Кто потревожит покой фараона, умрет через 7 дней'. Игорь не верит в проклятия. Но на следующий день его ассистент умер при странных обстоятельствах. Теперь у Игоря 6 дней, чтобы решить - вернуть артефакты или найти способ снять проклятие...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-yellow-600 to-orange-600",
    exampleQuestions: [
      "Что было бы, если бы он вернул артефакты?",
      "Что если проклятие можно снять?",
      "Что было бы, если бы он не верил до конца?"
    ]
  },
  {
    id: "teacher",
    title: "Трудный класс",
    category: "Школа",
    story: "Учитель Дмитрий получил самый проблемный класс в школе. Ученики не уважают учителей, прогуливают уроки. Директор дал ему один семестр, чтобы изменить ситуацию, иначе класс расформируют. Дмитрий узнал, что лидер класса - талантливый программист, но у него проблемы дома. Дмитрий может помочь ему, но это против правил...",
    icon: <BookOpen className="w-6 h-6" />,
    color: "from-blue-500 to-indigo-500",
    exampleQuestions: [
      "Что было бы, если бы он нарушил правила?",
      "Что если класс всё равно расформируют?",
      "Что было бы, если бы он нашел другой подход?"
    ]
  },
  {
    id: "firefighter",
    title: "В огне",
    category: "Героизм",
    story: "Пожарный Алексей получил вызов - горит жилой дом. Внутри остались люди. Когда он вошел в здание, услышал крики с двух сторон - слева ребенок, справа пожилая пара. Времени спасти всех нет - здание рушится. Алексей должен выбрать, кого спасти первым, зная, что второй шанс может не представиться...",
    icon: <Sword className="w-6 h-6" />,
    color: "from-red-600 to-orange-600",
    exampleQuestions: [
      "Что было бы, если бы он выбрал ребенка?",
      "Что если он попытался спасти всех?",
      "Что было бы, если бы пришло подкрепление?"
    ]
  },
  {
    id: "photographer",
    title: "Идеальный кадр",
    category: "Искусство",
    story: "Фотограф Елена работала над проектом о жизни бездомных. Однажды она стала свидетелем преступления и сделала фото преступника. Снимок может посадить его в тюрьму, но также выиграть главную премию года. Однако преступник - бывший солдат, который украл еду для своих детей. Елена должна выбрать между карьерой и совестью...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-purple-500 to-pink-500",
    exampleQuestions: [
      "Что было бы, если бы она отдала фото полиции?",
      "Что если она помогла ему вместо этого?",
      "Что было бы, если бы она опубликовала фото анонимно?"
    ]
  },
  {
    id: "diplomat",
    title: "Мирные переговоры",
    category: "Политика",
    story: "Дипломат Виктор ведет переговоры между двумя враждующими странами. Обе стороны готовы к миру, но есть одно условие - каждая требует извинений от другой первой. Виктор знает секрет - лидер одной страны смертельно болен и хочет мира перед смертью. Виктор может использовать эту информацию, но это нарушит доверие...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-blue-600 to-indigo-600",
    exampleQuestions: [
      "Что было бы, если бы он раскрыл секрет?",
      "Что если переговоры провалятся?",
      "Что было бы, если бы он нашел компромисс?"
    ]
  },
  {
    id: "veterinarian",
    title: "Последний шанс",
    category: "Животные",
    story: "Ветеринар Марина лечит редкого тигра, последнего в своем виде. Тигр смертельно болен. Есть экспериментальное лекарство, но оно не тестировалось. Шанс успеха 50%. Без лечения тигр умрет через неделю. Владелец зоопарка настаивает на эвтаназии, чтобы тигр не мучился. Марина должна решить судьбу последнего представителя вида...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-green-500 to-emerald-500",
    exampleQuestions: [
      "Что было бы, если бы она попробовала лекарство?",
      "Что если тигр выжил и дал потомство?",
      "Что было бы, если бы она отпустила его на волю?"
    ]
  },
  {
    id: "miner",
    title: "Обвал в шахте",
    category: "Выживание",
    story: "Шахтер Петр и его бригада из 10 человек оказались заблокированы после обвала. Кислорода хватит на 48 часов. Связь с поверхностью потеряна. Петр нашел узкий проход, через который может пройти только один человек. Он ведет к старой шахте, откуда можно выбраться. Но если кто-то пойдет, остальные могут не дождаться спасателей...",
    icon: <Sword className="w-6 h-6" />,
    color: "from-gray-600 to-stone-700",
    exampleQuestions: [
      "Что было бы, если бы Петр пошел сам?",
      "Что если они все попытались пройти?",
      "Что было бы, если бы они остались ждать?"
    ]
  },
  {
    id: "psychologist",
    title: "Опасный пациент",
    category: "Психология",
    story: "Психолог Анна работает с пациентом, который признался ей, что планирует убийство. По закону она должна сообщить в полицию, но тогда нарушит врачебную тайну и потеряет лицензию. Пациент говорит, что жертва - насильник его сестры, которого суд оправдал. Анна должна выбрать между законом, этикой и справедливостью...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-indigo-500 to-purple-500",
    exampleQuestions: [
      "Что было бы, если бы она сообщила в полицию?",
      "Что если она попыталась остановить его сама?",
      "Что было бы, если бы она помогла ему найти другой путь?"
    ]
  },
  {
    id: "astronomer",
    title: "Сигнал из космоса",
    category: "Космос",
    story: "Астроном Игорь обнаружил астероид, который столкнется с Землей через 6 месяцев. Это вызовет глобальную катастрофу. Он сообщил в NASA, но правительства решили скрыть информацию, чтобы избежать паники. Игорь может рассказать миру правду, но его объявят сумасшедшим и посадят. Или он может молчать, зная, что миллионы умрут...",
    icon: <Rocket className="w-6 h-6" />,
    color: "from-purple-600 to-blue-600",
    exampleQuestions: [
      "Что было бы, если бы он рассказал правду?",
      "Что если есть способ остановить астероид?",
      "Что было бы, если бы он ошибся в расчетах?"
    ]
  },
  {
    id: "lawyer",
    title: "Невиновный клиент",
    category: "Юриспруденция",
    story: "Адвокат Сергей защищает клиента, обвиняемого в убийстве. Все улики против него. Но Сергей случайно узнал, что настоящий убийца - его старый друг, который подставил клиента. У Сергея нет доказательств. Он может использовать незаконные методы, чтобы получить признание друга, или позволить невиновному сесть в тюрьму...",
    icon: <Briefcase className="w-6 h-6" />,
    color: "from-gray-700 to-slate-800",
    exampleQuestions: [
      "Что было бы, если бы он использовал незаконные методы?",
      "Что если друг сам признается?",
      "Что было бы, если бы он нашел доказательства?"
    ]
  },
  {
    id: "sailor",
    title: "Шторм в океане",
    category: "Море",
    story: "Капитан Андрей ведет грузовое судно через океан. Начался сильнейший шторм. Груз начал смещаться, судно кренится. Чтобы спасти корабль и экипаж, нужно сбросить часть груза в море. Но груз - гуманитарная помощь для голодающих детей Африки. Андрей должен выбрать между жизнями экипажа и жизнями тысяч детей...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-blue-700 to-cyan-700",
    exampleQuestions: [
      "Что было бы, если бы он сбросил груз?",
      "Что если шторм утих в последний момент?",
      "Что было бы, если бы он нашел другое решение?"
    ]
  },
  {
    id: "inventor",
    title: "Опасное изобретение",
    category: "Наука",
    story: "Изобретатель Николай создал устройство для чтения мыслей. Оно работает идеально. Военные предлагают миллиарды за технологию. Николай знает, что это оружие будет использовано для контроля людей. Его жена тяжело больна, деньги спасут её. Николай должен выбрать между любовью и человечеством...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-cyan-500 to-blue-500",
    exampleQuestions: [
      "Что было бы, если бы он продал изобретение?",
      "Что если он уничтожил все чертежи?",
      "Что было бы, если бы он нашел другого покупателя?"
    ]
  },
  {
    id: "spy",
    title: "Двойной агент",
    category: "Шпионаж",
    story: "Агент Ольга 5 лет работала двойным агентом. Она передавала секреты обеим сторонам, сохраняя баланс. Но теперь обе стороны узнали правду. У неё есть 24 часа, чтобы выбрать сторону или исчезнуть. Но исчезновение означает оставить дочь, которая не знает, кто её мать на самом деле...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-gray-800 to-black",
    exampleQuestions: [
      "Что было бы, если бы она выбрала одну сторону?",
      "Что если она рассказала дочери правду?",
      "Что было бы, если бы она попыталась играть дальше?"
    ]
  },
  {
    id: "zookeeper",
    title: "Побег из зоопарка",
    category: "Животные",
    story: "Смотритель зоопарка Иван обнаружил, что ночью кто-то открыл все клетки. Хищники на свободе. В зоопарке остались посетители - группа детей на экскурсии. У Ивана есть транквилизатор на 3 выстрела, но хищников больше. Он может эвакуировать детей, но тогда животные разбегутся по городу...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-green-600 to-yellow-600",
    exampleQuestions: [
      "Что было бы, если бы он выбрал детей?",
      "Что если животные не агрессивны?",
      "Что было бы, если бы он нашел того, кто открыл клетки?"
    ]
  },
  {
    id: "mountaineer",
    title: "На вершине",
    category: "Экстрим",
    story: "Альпинист Дмитрий и его напарник Сергей покоряли Эверест. На высоте 8000 метров Сергей сорвался и повис на веревке. Дмитрий держит его, но веревка рвется. Если он не отпустит, они оба упадут. Если отпустит - Сергей погибнет, но Дмитрий выживет. У него 30 секунд на решение...",
    icon: <Sword className="w-6 h-6" />,
    color: "from-gray-500 to-blue-500",
    exampleQuestions: [
      "Что было бы, если бы он отпустил веревку?",
      "Что если пришла помощь?",
      "Что было бы, если бы они оба попытались спастись?"
    ]
  },
  {
    id: "conductor",
    title: "Последний концерт",
    category: "Музыка",
    story: "Дирижер Михаил готовился к прощальному концерту перед уходом на пенсию. За час до выступления он узнал, что его лучший друг и первая скрипка украл деньги оркестра. Михаил может выгнать его прямо сейчас, но тогда концерт сорвется. Или он может промолчать и позволить другу уйти с деньгами...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-purple-600 to-pink-600",
    exampleQuestions: [
      "Что было бы, если бы он выгнал друга?",
      "Что если друг вернул деньги?",
      "Что было бы, если бы концерт прошел идеально?"
    ]
  },
  {
    id: "architect",
    title: "Опасный проект",
    category: "Архитектура",
    story: "Архитектор Елена спроектировала небоскреб. За день до начала строительства она обнаружила ошибку в расчетах - здание может рухнуть при землетрясении. Исправление займет год и миллионы. Заказчик отказывается ждать. Елена может промолчать и сохранить репутацию, или остановить стройку и потерять всё...",
    icon: <Briefcase className="w-6 h-6" />,
    color: "from-gray-600 to-stone-600",
    exampleQuestions: [
      "Что было бы, если бы она промолчала?",
      "Что если землетрясения не будет?",
      "Что было бы, если бы она нашла быстрое решение?"
    ]
  },
  {
    id: "priest",
    title: "Тайна исповеди",
    category: "Религия",
    story: "Священник Павел принял исповедь человека, который признался в убийстве. По церковным законам тайна исповеди священна. Но Павел знает, что убийца планирует новое преступление. Полиция ищет его. Павел должен выбрать между верой и законом, между спасением души и спасением жизни...",
    icon: <BookOpen className="w-6 h-6" />,
    color: "from-yellow-700 to-amber-700",
    exampleQuestions: [
      "Что было бы, если бы он нарушил тайну?",
      "Что если он попытался остановить убийцу сам?",
      "Что было бы, если бы убийца раскаялся?"
    ]
  },
  {
    id: "racer",
    title: "Последняя гонка",
    category: "Спорт",
    story: "Гонщик Алексей участвует в финальной гонке чемпионата. Он лидирует. Но его главный соперник - его брат Иван. За круг до финиша Иван попал в аварию. Алексей может остановиться и помочь, но тогда проиграет чемпионат. Или он может продолжить гонку, зная, что брат может погибнуть...",
    icon: <Crown className="w-6 h-6" />,
    color: "from-red-600 to-orange-600",
    exampleQuestions: [
      "Что было бы, если бы он остановился?",
      "Что если брат выжил сам?",
      "Что было бы, если бы он выиграл?"
    ]
  },
  {
    id: "translator",
    title: "Опасный перевод",
    category: "Лингвистика",
    story: "Переводчик Мария работает на международных переговорах. Она случайно услышала, как один из делегатов планирует теракт. Но она не может доказать это - разговор был на редком диалекте, который знает только она. Если она расскажет, её обвинят в шпионаже. Если промолчит - погибнут люди...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-blue-500 to-purple-500",
    exampleQuestions: [
      "Что было бы, если бы она рассказала?",
      "Что если она попыталась остановить теракт сама?",
      "Что было бы, если бы она записала разговор?"
    ]
  },
  {
    id: "gardener",
    title: "Последнее дерево",
    category: "Экология",
    story: "Садовник Петр ухаживает за последним деревом редкого вида. Дерево умирает. Есть способ спасти его - пересадить в другое место, но это убьет все растения вокруг. Или можно оставить дерево, и оно умрет, но сохранит экосистему. Петр должен выбрать между одним редким видом и сотнями обычных...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-green-600 to-emerald-600",
    exampleQuestions: [
      "Что было бы, если бы он пересадил дерево?",
      "Что если нашелся другой способ?",
      "Что было бы, если бы дерево выжило само?"
    ]
  },
  {
    id: "magician",
    title: "Настоящая магия",
    category: "Фэнтези",
    story: "Фокусник Артур всю жизнь делал трюки. Но однажды во время выступления он случайно произнес настоящее заклинание и обрел реальную магию. Теперь тайная организация магов хочет принять его в свои ряды, но для этого он должен стереть память всем, кто видел его настоящую магию, включая его семью...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-purple-600 to-indigo-600",
    exampleQuestions: [
      "Что было бы, если бы он согласился?",
      "Что если он отказался от магии?",
      "Что было бы, если бы он научил семью магии?"
    ]
  },
  {
    id: "fisherman",
    title: "Сокровище на дне",
    category: "Приключения",
    story: "Рыбак Василий нашел в сетях старинную карту с указанием места затонувшего корабля с сокровищами. Он может попытаться найти клад сам, но это опасно и незаконно. Или он может продать карту коллекционеру за хорошие деньги. Или отдать в музей и стать героем, но остаться бедным...",
    icon: <Globe className="w-6 h-6" />,
    color: "from-blue-600 to-teal-600",
    exampleQuestions: [
      "Что было бы, если бы он искал клад сам?",
      "Что если клад проклят?",
      "Что было бы, если бы он нашел больше, чем ожидал?"
    ]
  },
  {
    id: "locksmith",
    title: "Запертая дверь",
    category: "Детектив",
    story: "Слесарь Игорь получил вызов открыть дверь квартиры. Клиент говорит, что потерял ключи. Но когда Игорь открыл дверь, он увидел связанного человека внутри. 'Клиент' оказался грабителем. Игорь может позвонить в полицию, но тогда грабитель может убить его. Или он может уйти, как будто ничего не видел...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-gray-700 to-red-700",
    exampleQuestions: [
      "Что было бы, если бы он позвонил в полицию?",
      "Что если он попытался спасти жертву сам?",
      "Что было бы, если бы он притворился, что ничего не видел?"
    ]
  },
  {
    id: "blogger",
    title: "Вирусное видео",
    category: "Социальные сети",
    story: "Блогер Настя случайно сняла на видео преступление. Видео может стать вирусным и принести миллионы просмотров. Но преступник - её бывший парень, который угрожает ей. Настя может опубликовать видео и стать знаменитой, но рискует жизнью. Или удалить его и остаться в безопасности...",
    icon: <Eye className="w-6 h-6" />,
    color: "from-pink-500 to-red-500",
    exampleQuestions: [
      "Что было бы, если бы она опубликовала видео?",
      "Что если полиция нашла преступника сама?",
      "Что было бы, если бы она опубликовала анонимно?"
    ]
  },
  {
    id: "watchmaker",
    title: "Часы времени",
    category: "Мистика",
    story: "Часовщик Григорий ремонтировал старинные часы и обнаружил, что они могут замедлять время на 1 час в день. Он может использовать это для себя - получить больше времени на работу, семью, хобби. Но каждый раз, когда он использует часы, кто-то в мире теряет час своей жизни. Григорий не знает кто, но знает, что это происходит...",
    icon: <Sparkles className="w-6 h-6" />,
    color: "from-amber-600 to-orange-600",
    exampleQuestions: [
      "Что было бы, если бы он продолжал использовать часы?",
      "Что если он уничтожил часы?",
      "Что было бы, если бы он нашел способ контролировать эффект?"
    ]
  },
  {
    id: "lifeguard",
    title: "Выбор на пляже",
    category: "Героизм",
    story: "Спасатель Антон дежурил на пляже, когда увидел двух тонущих людей в разных местах - ребенка и взрослого мужчину. Он один, помощи нет. Течение сильное. Антон может спасти только одного. Ребенок ближе, но мужчина - его отец, который кричит спасти сына. У Антона секунды на решение...",
    icon: <Heart className="w-6 h-6" />,
    color: "from-blue-500 to-cyan-500",
    exampleQuestions: [
      "Что было бы, если бы он спас ребенка?",
      "Что если он попытался спасти обоих?",
      "Что было бы, если бы пришла помощь?"
    ]
  }
]

export default function TemplatesPage() {
  const [selectedTemplate, setSelectedTemplate] = useState<Template | null>(null)
  const [copiedTemplate, setCopiedTemplate] = useState<string | null>(null)
  const [selectedCategory, setSelectedCategory] = useState<string>('Все')
  const [sortBy, setSortBy] = useState<'default' | 'title' | 'category'>('default')

  // Получаем уникальные категории
  const categories = ['Все', ...Array.from(new Set(templates.map(t => t.category)))]

  // Фильтруем и сортируем шаблоны
  const filteredAndSortedTemplates = templates
    .filter(template => selectedCategory === 'Все' || template.category === selectedCategory)
    .sort((a, b) => {
      if (sortBy === 'title') return a.title.localeCompare(b.title, 'ru')
      if (sortBy === 'category') return a.category.localeCompare(b.category, 'ru')
      return 0 // default order
    })

  const copyToClipboard = (text: string, templateId: string) => {
    navigator.clipboard.writeText(text)
    setCopiedTemplate(templateId)
    setTimeout(() => setCopiedTemplate(null), 2000)
  }

  return (
    <ProtectedRoute>
      <div className="min-h-screen font-serif relative overflow-hidden">
        {/* Книжный фон */}
        <div className="absolute inset-0 pointer-events-none opacity-20">
          <div className="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-ink-light/10 to-transparent" />
          <div className="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-ink-light/10 to-transparent" />
        </div>

        {/* Header */}
        <header className="relative z-20 border-b border-border bg-card/80 backdrop-blur-sm shadow-sm">
          <div className="flex justify-between items-center px-6 py-4">
            <Link href="/" className="book-button-secondary text-sm">
              <ArrowLeft className="w-4 h-4" />
              Назад
            </Link>
            <ThemeToggle />
          </div>
        </header>

        {/* Main content */}
        <main className="relative z-10 px-6 pb-12">
          {!selectedTemplate ? (
            <>
              {/* Title */}
              <AnimatedContainer delay={100}>
                <div className="text-center mb-12">
                  <div className="flex justify-center mb-6">
                    <div className="w-20 h-20 rounded-full bg-primary/10 border-2 border-primary/30 flex items-center justify-center animate-float">
                      <BookOpen className="w-10 h-10 text-primary" />
                    </div>
                  </div>
                  <h1 className="text-4xl md:text-5xl font-bold mb-4 text-ink font-serif">
                    Шаблоны историй
                  </h1>
                  <p className="text-ink/60 uppercase text-sm tracking-widest font-sans">
                    Выберите готовый шаблон для создания альтернативных сценариев
                  </p>
                </div>
              </AnimatedContainer>

              {/* Filters and sorting */}
              <AnimatedContainer delay={200}>
                <Card className="max-w-7xl mx-auto mb-8 p-6 book-card">
                  {/* Category filter */}
                  <div className="flex flex-wrap gap-2 justify-center mb-4">
                    {categories.map((category) => (
                      <button
                        key={category}
                        onClick={() => setSelectedCategory(category)}
                        className={`px-4 py-2 border text-sm font-medium uppercase tracking-wider transition-all duration-300 rounded-md ${selectedCategory === category
                          ? 'border-primary bg-primary/10 text-primary'
                          : 'border-border text-ink/60 hover:border-primary/50 hover:text-primary'
                          }`}
                      >
                        {category}
                      </button>
                    ))}
                  </div>

                  {/* Sort options */}
                  <div className="flex items-center justify-center gap-4">
                    <span className="text-xs uppercase tracking-widest text-ink/50 font-sans">Сортировка:</span>
                    <select
                      value={sortBy}
                      onChange={(e) => setSortBy(e.target.value as 'default' | 'title' | 'category')}
                      className="px-4 py-2 bg-background/50 border-2 border-primary/20 text-ink font-serif focus:border-primary outline-none book-input"
                    >
                      <option value="default">По умолчанию</option>
                      <option value="title">По названию</option>
                      <option value="category">По категории</option>
                    </select>
                    <span className="text-xs uppercase tracking-widest text-primary font-sans">
                      Найдено: {filteredAndSortedTemplates.length}
                    </span>
                  </div>
                </Card>
              </AnimatedContainer>

              {/* Templates grid */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 max-w-7xl mx-auto">
                {filteredAndSortedTemplates.map((template, index) => (
                  <AnimatedContainer key={template.id} delay={300 + index * 50}>
                    <button
                      onClick={() => setSelectedTemplate(template)}
                      className="w-full border border-border bg-card/50 backdrop-blur p-4 text-left hover:border-primary hover:bg-primary/5 transition-all duration-300 group book-card hover-lift"
                    >
                      <div className="space-y-4">
                        {/* Icon and category */}
                        <div className="flex items-center gap-3">
                          <div className={`w-12 h-12 border-2 border-primary/30 bg-primary/10 flex items-center justify-center text-primary rounded-md group-hover:scale-110 transition-transform duration-300`}>
                            {template.icon}
                          </div>
                          <div>
                            <h3 className="font-bold text-ink uppercase text-sm font-serif">{template.title}</h3>
                            <p className="text-xs text-primary/70 uppercase tracking-wider font-sans">{template.category}</p>
                          </div>
                        </div>

                        {/* Story preview */}
                        <p className="text-sm text-ink/60 line-clamp-3 font-serif italic">
                          {template.story.substring(0, 120)}...
                        </p>

                        {/* View button */}
                        <div className="flex items-center text-xs text-primary uppercase tracking-widest font-sans group-hover:text-primary/80 transition-colors">
                          <Eye className="w-4 h-4 mr-2" />
                          Подробнее
                        </div>
                      </div>
                    </button>
                  </AnimatedContainer>
                ))}
              </div>
            </>
          ) : (
            /* Template details */
            <AnimatedContainer>
              <div className="max-w-4xl mx-auto">
                {/* Back button */}
                <button
                  onClick={() => setSelectedTemplate(null)}
                  className="book-button-secondary mb-6"
                >
                  <ArrowLeft className="w-4 h-4 mr-2" />
                  К шаблонам
                </button>

                {/* Template header */}
                <Card className="mb-6 book-card">
                  <div className="flex items-center space-x-4 mb-4">
                    <div className={`w-16 h-16 rounded-full bg-primary/10 border-2 border-primary/30 flex items-center justify-center text-primary`}>
                      {selectedTemplate.icon}
                    </div>
                    <div>
                      <h1 className="text-3xl font-bold text-ink font-serif">{selectedTemplate.title}</h1>
                      <p className="text-lg text-ink/60 font-serif italic">{selectedTemplate.category}</p>
                    </div>
                  </div>
                </Card>

                {/* Story content */}
                <Card className="mb-6 book-card">
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-xl font-semibold text-ink font-serif">История</h2>
                    <button
                      onClick={() => copyToClipboard(selectedTemplate.story, selectedTemplate.id)}
                      className={`book-button-secondary text-sm ${copiedTemplate === selectedTemplate.id
                        ? 'bg-green-500/20 border-green-500/50 text-green-600'
                        : ''
                        }`}
                    >
                      <Copy className="w-4 h-4 mr-2" />
                      {copiedTemplate === selectedTemplate.id ? 'Скопировано!' : 'Копировать'}
                    </button>
                  </div>
                  <p className="text-ink leading-relaxed text-lg font-serif">
                    {selectedTemplate.story}
                  </p>
                </Card>

                {/* Example questions */}
                <Card className="mb-6 book-card">
                  <h2 className="text-xl font-semibold text-ink mb-4 font-serif">Примеры вопросов "Что было бы, если..."</h2>
                  <div className="space-y-3">
                    {selectedTemplate.exampleQuestions.map((question, index) => (
                      <div key={index} className="flex items-start space-x-3 p-3 bg-primary/5 rounded-lg border border-primary/10">
                        <div className="w-6 h-6 bg-primary/10 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 border border-primary/30">
                          <span className="text-xs font-semibold text-primary">{index + 1}</span>
                        </div>
                        <p className="text-ink font-serif flex-1">{question}</p>
                        <button
                          onClick={() => copyToClipboard(question, `q${index}`)}
                          className={`book-button-secondary text-xs px-2 py-1 flex-shrink-0 ${copiedTemplate === `q${index}`
                            ? 'bg-green-500/20 border-green-500/50 text-green-600'
                            : ''
                            }`}
                        >
                          <Copy className="w-3 h-3" />
                        </button>
                      </div>
                    ))}
                  </div>
                </Card>

                {/* Action buttons */}
                <div className="flex flex-col sm:flex-row gap-4">
                  <Link
                    href={`/what-if?template=${encodeURIComponent(JSON.stringify({
                      story: selectedTemplate.story,
                      title: selectedTemplate.title
                    }))}`}
                    className="book-button flex-1 text-center"
                  >
                    <Sparkles className="w-5 h-5 mr-2" />
                    Использовать шаблон
                  </Link>
                  <button
                    onClick={() => copyToClipboard(
                      `${selectedTemplate.story}\n\nПримеры вопросов:\n${selectedTemplate.exampleQuestions.map((q, i) => `${i + 1}. ${q}`).join('\n')}`,
                      'full'
                    )}
                    className={`book-button-secondary flex-1 ${copiedTemplate === 'full'
                      ? 'bg-green-500/20 border-green-500/50 text-green-600'
                      : ''
                      }`}
                  >
                    <Copy className="w-5 h-5 mr-2" />
                    {copiedTemplate === 'full' ? 'Скопировано!' : 'Копировать всё'}
                  </button>
                </div>
              </div>
            </AnimatedContainer>
          )}
        </main>
      </div>
    </ProtectedRoute>
  )
}
