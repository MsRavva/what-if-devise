# Конфигурация ИИ для генерации готовых сюжетов

## Что было сделано

### 1. Улучшена конфигурация AI-сервиса

Файл: `src/lib/ai-service.ts`

- Добавлена проверка наличия Hugging Face API ключа
- Реализована система fallback с использованием нескольких моделей:
  1. microsoft/DialoGPT-medium
  2. gpt2
  3. distilgpt2
  4. google/flan-t5-base
  5. EleutherAI/gpt-j-6B
- Улучшены параметры генерации для более качественных результатов:
  - temperature: 0.85 (оптимальный баланс между креативностью и связностью)
  - top_p: 0.9 (nucleus sampling для лучшего качества)
  - repetition_penalty: 1.15 (уменьшение повторений)
- Созданы более детализированные промпты для генерации сценариев
- Добавлена обработка ошибок с понятными сообщениями для пользователя

### 2. Улучшена обработка ошибок в API

Файл: `src/app/api/generate-scenario/route.ts`

- Добавлена автоматическая попытка использования альтернативной модели при ошибке
- Улучшена обработка ошибок с возвратом понятных сообщений
- Добавлены метаданные для отладки

### 3. Улучшен пользовательский интерфейс

Файл: `src/app/what-if/page.tsx`

- Добавлена кнопка "Тест AI" для проверки подключения к сервису
- Улучшена обработка ошибок с кнопками повторной попытки
- Добавлена система повторных попыток генерации
- Улучшено форматирование вывода сценариев

### 4. Добавлены вспомогательные инструменты

- Создан тестовый скрипт для проверки API
- Создан скрипт для проверки переменных окружения
- Создан пример файла конфигурации `.env.local.example`
- Создан файл `.gitignore` для защиты чувствительных данных

### 5. Обновлена документация

- Улучшены инструкции по настройке Hugging Face API ключа
- Добавлено руководство по устранению неполадок
- Добавлены примеры использования

## Как использовать

### Для генерации сценариев:

1. Убедитесь, что Hugging Face API ключ настроен в файле `.env.local`
2. Запустите сервер разработки: `pnpm dev`
3. Откройте приложение в браузере: http://localhost:3000
4. Перейдите на страницу "Генератор сценариев"
5. Введите историю и вопрос "что если"
6. Нажмите "Создать альтернативный сценарий"

### При возникновении ошибок:

1. Проверьте подключение к интернету
2. Убедитесь, что API ключ действителен
3. Используйте кнопку "Тест AI" для диагностики
4. Попробуйте перегенерировать сценарий
5. Обратитесь к руководству по устранению неполадок

## Преимущества новой конфигурации

1. **Надежность:** Система fallback пробует несколько моделей при ошибке
2. **Качество:** Улучшенные параметры генерации и промпты
3. **Пользовательский опыт:** Понятные сообщения об ошибках и возможность повторной попытки
4. **Безопасность:** Защита чувствительных данных через .gitignore
5. **Документация:** Полное руководство по настройке и устранению неполадок

## Требования

1. Действующий API ключ от Hugging Face
2. Подключение к интернету
3. Node.js 18 или выше
4. pnpm (пакетный менеджер)