# Исправление генерации ИИ в гостевом режиме

## Проблема
ИИ не генерировал сценарии в гостевом режиме из-за обязательной проверки токена авторизации в клиентском коде.

## Что было исправлено

### 1. ChatInterface.tsx
**Проблема:** Компонент требовал токен авторизации для всех запросов к API, блокируя гостей.

**Исправления:**
- Убрана обязательная проверка `if (!token) { throw new Error('Требуется авторизация'); }`
- Токен теперь добавляется в заголовки только если пользователь авторизован
- Сохранение сценария происходит только для авторизованных пользователей
- Гости могут генерировать сценарии без сохранения в БД

### 2. .env.local.example
**Проблема:** Неправильное имя переменной окружения для Hugging Face API.

**Исправление:**
- Изменено `HUGGING_FACE_API_KEY` на `HF_TOKEN` (как используется в коде)

### 3. Импорты в ChatInterface.tsx
**Проблема:** Отсутствовал импорт иконки `BookOpen`.

**Исправление:**
- Добавлен `BookOpen` в импорты из `lucide-react`

## Как это работает теперь

### Для гостей:
1. Пользователь заходит на `/what-if` без авторизации
2. Заполняет форму и отправляет
3. Запрос идёт в `/api/generate-scenario` БЕЗ токена авторизации
4. API генерирует сценарий через Hugging Face
5. Сценарий возвращается пользователю, но НЕ сохраняется в БД
6. Пользователь может продолжить диалог в чате

### Для авторизованных пользователей:
1. Всё то же самое, но:
2. Токен добавляется в заголовки запроса
3. Сценарий сохраняется в БД
4. Доступна история всех сценариев

## Технические детали

### API роут (уже был готов)
`/api/generate-scenario` уже поддерживал гостевой режим:
```typescript
// Пытаемся получить аутентифицированного пользователя (необязательно)
let userId: string | null = null;
try {
  const user = await getAuthenticatedUser(request.headers);
  userId = user.id;
} catch (error) {
  // Пользователь не аутентифицирован - это нормально
  console.log('Пользователь не аутентифицирован, работаем в гостевом режиме');
}
```

### Клиентский код (было исправлено)
Теперь токен опционален:
```typescript
const { data: { session } } = await supabase!.auth.getSession();
const token = session?.access_token;

const headers: HeadersInit = { 
  'Content-Type': 'application/json'
};

// Добавляем токен только если пользователь авторизован
if (token) {
  headers['Authorization'] = `Bearer ${token}`;
}
```

## Результат
✅ Гости могут генерировать сценарии без регистрации
✅ Авторизованные пользователи получают сохранение в БД
✅ Нет ошибок "Требуется авторизация"
✅ API работает корректно в обоих режимах
