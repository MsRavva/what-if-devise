# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ "What If Device"

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è "What If Device".

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: ‚úÖ v1.0.0 –†–ï–õ–ò–ó

**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** –§–µ–≤—Ä–∞–ª—å 2025

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```mermaid
graph TD
    subgraph "–ö–ª–∏–µ–Ω—Ç (Next.js 14)"
        A["/ - –ì–ª–∞–≤–Ω–∞—è"] --> B["/what-if - –°–æ–∑–¥–∞–Ω–∏–µ"]
        A --> C["/cinema - –†–µ–∂–∏–º –ö–∏–Ω–æ"]
        A --> D["/templates - –®–∞–±–ª–æ–Ω—ã"]
        A --> E["/auth - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"]
        B --> F{API /generate-scenario}
        C --> F
        D --> G[–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ]
        B --> H[Supabase - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ]
        C --> H
    end

    subgraph "API Layer"
        F --> I[Hugging Face API]
        F --> J[Rate Limiter]
    end

    subgraph "–•—Ä–∞–Ω–µ–Ω–∏–µ"
        H[(Supabase PostgreSQL)]
        K[localStorage] --> C
    end

    style A fill:#f4ecd8,stroke:#3c2f1f,stroke-width:2px
    style C fill:#f4ecd8,stroke:#3c2f1f,stroke-width:2px
    style D fill:#f4ecd8,stroke:#3c2f1f,stroke-width:2px
```

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚úÖ

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Next.js 14 —Å App Router
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Tailwind CSS –∏ shadcn/ui
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TypeScript
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env.local)

### –≠—Ç–∞–ø 2: AI –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚úÖ
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Hugging Face API
- [x] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Qwen/Qwen2.5-72B-Instruct
- [x] API –º–∞—Ä—à—Ä—É—Ç /api/generate-scenario
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤
- [x] Rate limiting (10/50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å)

### –≠—Ç–∞–ø 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚úÖ
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supabase
- [x] –¢–∞–±–ª–∏—Ü—ã: stories, scenarios
- [x] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] Email/Password –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- [x] Google OAuth
- [x] –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 4: –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ‚úÖ
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è (/what-if)
- [x] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç (/chat/[id])
- [x] –ò—Å—Ç–æ—Ä–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (/history)
- [x] –°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ (/templates)
  - [x] 64 —à–∞–±–ª–æ–Ω–∞ –∏—Å—Ç–æ—Ä–∏–π
  - [x] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  - [x] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  - [x] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

### –≠—Ç–∞–ø 5: –†–µ–∂–∏–º –ö–∏–Ω–æ ‚úÖ
- [x] –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å –≤—ã–±–æ—Ä–æ–º
- [x] 6 –∂–∞–Ω—Ä–æ–≤ (–∫–∏–±–µ—Ä–ø–∞–Ω–∫, —Ñ—ç–Ω—Ç–µ–∑–∏, –Ω—É–∞—Ä, —Ö–æ—Ä—Ä–æ—Ä, sci-fi, –º–∏—Å—Ç–∏–∫–∞)
- [x] –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (seed-based)
- [x] 8 —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ü–æ–≤–æ–∫
- [x] –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥)
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –≤ localStorage
- [x] –ö–æ–¥ —Å–µ—Å—Å–∏–∏ –¥–ª—è –æ–±–º–µ–Ω–∞ —Å –¥—Ä—É–∑—å—è–º–∏

### –≠—Ç–∞–ø 6: UI/UX ‚úÖ
- [x] –ö–Ω–∏–∂–Ω–∞—è —Ç–µ–º–∞ (–≤–∏–Ω—Ç–∞–∂/–ø–µ—Ä–≥–∞–º–µ–Ω—Ç)
- [x] –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: –∫—Ä–µ–º–æ–≤—ã–π/–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π
- [x] –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞: EB Garamond + Inter
- [x] –ê–Ω–∏–º–∞—Ü–∏–∏:
  - [x] Fade in/out
  - [x] Slide transitions
  - [x] Hover —ç—Ñ—Ñ–µ–∫—Ç—ã (lift, glow)
  - [x] –ü–µ—á–∞—Ç–Ω–∞—è –º–∞—à–∏–Ω–∫–∞
  - [x] Float –∞–Ω–∏–º–∞—Ü–∏—è
- [x] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- [x] –¢–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
- [x] –ò–∫–æ–Ω–∫–∏ —Å–∞–π—Ç–∞ (SVG)

### –≠—Ç–∞–ø 7: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞ ‚úÖ
- [x] –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –∏–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫
- [x] –ö–æ–º–ø–æ–Ω–µ–Ω—Ç QuestionLoader
- [x] Suspense boundaries
- [x] –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [x] Toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [x] Skeleton loaders

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Frontend
- **Framework:** Next.js 14.2.15
- **Language:** TypeScript 5.0
- **Styling:** Tailwind CSS 3.4
- **Components:** shadcn/ui
- **Fonts:** EB Garamond, Inter
- **Animation:** CSS + Framer Motion (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Backend
- **API:** Next.js API Routes
- **AI:** Hugging Face Inference API
- **Rate Limiting:** In-memory + Vercel KV (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Database & Auth
- **Provider:** Supabase
- **Database:** PostgreSQL
- **Auth:** Supabase Auth (Email + OAuth)
- **Storage:** localStorage (–≥–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º)

### Deployment
- **Platform:** Vercel
- **CI/CD:** GitHub Actions (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## API Endpoints

### POST /api/generate-scenario
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è –∏–ª–∏ —Å—Ü–µ–Ω—ã –¥–ª—è —Ä–µ–∂–∏–º–∞ –ö–∏–Ω–æ.

**Request:**
```json
{
  "mode": "cinema" | null,
  "story": "string",
  "question": "string",
  "genre": "string" (optional),
  "history": ["string"] (optional)
}
```

**Response:**
```json
{
  "scenario": "string",
  "choices": [{"id": "string", "text": "string"}],
  "isEnding": boolean,
  "endingTitle": "string",
  "endingCode": "string"
}
```

### POST /api/scenario
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

**Request:**
```json
{
  "story_id": "uuid",
  "question": "string",
  "ai_response": "string"
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: stories
```sql
id: uuid (PK)
user_id: uuid (FK -> auth.users)
title: text
content: text
created_at: timestamp
created_by: uuid
```

### –¢–∞–±–ª–∏—Ü–∞: scenarios
```sql
id: uuid (PK)
story_id: uuid (FK -> stories)
user_id: uuid (FK -> auth.users)
question: text
ai_response: text
created_at: timestamp
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
HF_TOKEN=your_hugging_face_token

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

### AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
- –¢–∞–π–º–∞—É—Ç: 60 —Å–µ–∫—É–Ω–¥
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞: 1500 —Ç–æ–∫–µ–Ω–æ–≤
- Rate limit: 10/—á–∞—Å (–≥–æ—Å—Ç—å), 50/—á–∞—Å (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π)

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º: localStorage (~5MB)
- –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π: Supabase (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- –°–µ—Å—Å–∏–∏ –ö–∏–Ω–æ: localStorage

### –í–∞–ª–∏–¥–∞—Ü–∏—è
- –ò—Å—Ç–æ—Ä–∏—è: –º–∞–∫—Å. 50,000 —Å–∏–º–≤–æ–ª–æ–≤
- –í–æ–ø—Ä–æ—Å: –º–∞–∫—Å. 10,000 —Å–∏–º–≤–æ–ª–æ–≤
- XSS –∑–∞—â–∏—Ç–∞: –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏
- First Contentful Paint: < 1.5s
- Time to Interactive: < 3s
- API Response Time: < 30s (AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
- Lighthouse Score: > 80

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü (SSG)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (SVG –∏–∫–æ–Ω–∫–∏)
- Lazy loading –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API (5 –º–∏–Ω—É—Ç)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã
- ‚úÖ RLS (Row Level Security) –¥–ª—è Supabase
- ‚úÖ Rate limiting –Ω–∞ API
- ‚úÖ Input validation
- ‚úÖ XSS protection
- ‚úÖ CSRF protection (Next.js –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Vercel Analytics

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è üöÄ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –≠–∫—Å–ø–æ—Ä—Ç —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ PDF
- [ ] –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–º (–ø—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞)
- [ ] –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º (—Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ)

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (Web Speech API)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ AI –º–æ–¥–µ–ª—è–º–∏ (GPT-4, Claude)
- [ ] –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º (PWA)

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React Native)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–æ—Ü—Å–µ—Ç—è–º–∏
- [ ] –ü–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (–±–æ–ª—å—à–µ –ª–∏–º–∏—Ç–æ–≤)

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [PRD.md](./PRD.md) ‚Äî Product Requirements Document
- [README.md](../README.md) ‚Äî –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [TROUBLESHOOTING.md](../TROUBLESHOOTING.md) ‚Äî –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- [DEPLOY_GUIDE.md](../DEPLOY_GUIDE.md) ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –§–µ–≤—Ä–∞–ª—å 2025*
*–í–µ—Ä—Å–∏—è: 1.0.0*
