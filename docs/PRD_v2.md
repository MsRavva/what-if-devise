# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Веб-приложение "What If" - Генератор альтернативных сценариев

---

## 1. ОБЩЕЕ ОПИСАНИЕ ПРОЕКТА

**Название:** What If Device  
**Тип:** Веб-приложение для создания альтернативных сценариев историй  
**Цель:** Позволить пользователям вводить свои истории и получать ответы на вопросы "что было бы, если...". Приложение также предоставляет возможность уточнения и доработки сгенерированных сценариев через чат-интерфейс с интеграцией искусственного интеллекта.  

---

## 2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 2.1 Основной функционал
- **Ввод истории:** Текстовое поле для свободного ввода пользовательской истории
- **Формулировка вопроса:** Поле для ввода альтернативного сценария в свободной форме
- **Генерация ответа:** Обработка запроса через AI-модель и выдача результата
- **Сохранение историй:** Возможность сохранять созданные истории и сценарии

### 2.2 Система пользователей
- **Регистрация/авторизация:** Обязательная регистрация через Supabase Auth
- **Личный кабинет:** История созданных сценариев пользователя
- **Приватность:** Истории других пользователей не видны

### 2.3 История и управление
- **История просмотров:** Сохранение всех созданных пользователем сценариев
- **Повторное использование:** Возможность редактировать и переиспользовать сохраненные истории

### 2.4 Чат-интерфейс для уточнения сценария
- **Интерактивное взаимодействие:** Возможность задавать дополнительные вопросы и уточнения к уже сгенерированному сценарию
- **Контекстное понимание:** AI сохраняет контекст разговора для согласованного взаимодействия
- **Продолжение сценария:** Возможность модифицировать или развивать сгенерированный сценарий через диалог
- **Сохранение чата:** История чата сохраняется как часть сценария для дальнейшего просмотра

---

## 3. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ

### 3.1 Технологический стек
- **Фронтенд:** Next.js (TypeScript/TSX), Tailwind CSS, shadcn/ui
- **Бэкенд:** Supabase (база данных, аутентификация)
- **AI модель:** Hugging Face API через OpenAI SDK
- **Хостинг:** Vercel
- **Пакетный менеджер:** pnpm

### 3.2 Архитектура базы данных
```sql
-- Пользователи (через Supabase Auth)
-- Истории
stories:
  - id (UUID, PK)
  - user_id (UUID, FK)
  - title (TEXT)
  - content (TEXT)
  - created_at (TIMESTAMP)
  - updated_at (TIMESTAMP)

-- Сценарии "что если"
scenarios:
  - id (UUID, PK)
  - story_id (UUID, FK)
  - user_id (UUID, FK)
  - question (TEXT)
  - ai_response (TEXT)
  - created_at (TIMESTAMP)
```

### 3.3 AI интеграция
- **API:** Hugging Face API через OpenAI SDK
- **Модель:** openai/gpt-oss-20b:groq
- **Промпт-инжиниринг:** Структурированные промпты с требованиями к форматированию и стилю
- **Параметры генерации:** Температура 0.5, top_p 0.9, частотные/наличные штрафы для разнообразия и последовательности

### 3.4 API-маршруты для генерации
- **/api/generate-scenario:** Основной маршрут для генерации альтернативного сценария
- **/api/scenario:** Маршрут для сохранения сценария в базу данных с возможностью генерации при необходимости
- **/chat/[id]:** Страница чата для взаимодействия с конкретным сгенерированным сценарием

---

## 4. ПОЛЬЗОВАТЕЛЬСКИЙ ИНТЕРФЕЙС

### 4.1 Страницы
1. **Главная страница:** Краткое описание + кнопка начать
2. **Страница создания:** Форма ввода истории и вопроса
3. **Страница результата:** Отображение сгенерированного сценария
4. **Личный кабинет:** История пользователя
5. **Авторизация:** Вход/регистрация
6. **Чат-страница:** Интерактивное общение с AI по поводу сгенерированного сценария

### 4.2 Адаптивность
- **Мобильная версия:** Полная адаптация под мобильные устройства
- **Планшеты:** Оптимизация для средних экранов
- **Десктоп:** Основная версия

### 4.3 Чат-интерфейс
- **История сообщений:** Отображение всех сообщений пользователя и ответов AI
- **Интерактивное поле ввода:** Текстовое поле с возможностью отправки по нажатию Enter
- **Индикация загрузки:** Отображение статуса "печатает" во время генерации ответа

---

## 5. ПОЛЬЗОВАТЕЛЬСКИЕ СЦЕНАРИИ

### 5.1 Создание альтернативного сценария
1. Пользователь заходит на главную страницу и нажимает "Создать сценарий"
2. Вводит свою историю в текстовое поле
3. Формулирует вопрос "что если" в отдельном поле
4. Нажимает кнопку "Сгенерировать" и ожидает ответ AI
5. Просматривает сгенерированный сценарий и может сохранить его

### 5.2 Уточнение сгенерированного сценария через чат
1. Пользователь переходит к уже сгенерированному сценарию
2. Нажимает кнопку "Открыть чат" для взаимодействия с AI
3. В чате задает уточняющие вопросы или просит изменить определенные аспекты сценария
4. AI отвечает с учетом контекста оригинальной истории и предыдущих сообщений в чате
5. Пользователь может продолжать диалог до достижения желаемого результата

### 5.3 Повторное использование сценариев
1. Пользователь заходит в личный кабинет
2. Просматривает историю своих созданных сценариев
3. Выбирает один из сценариев для редактирования или продолжения
4. Может использовать чат-интерфейс для дальнейшей проработки сценария

---

## 6. НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 6.1 Производительность
- **Время ответа:** Страницы должны загружаться менее чем за 3 секунды
- **Генерация AI:** Время генерации зависит от выбранной модели и сложности запроса

### 6.2 Безопасность
- **Аутентификация:** Через Supabase Auth
- **Приватность:** Истории и чаты доступны только создателю
- **Защита API:** Защита от несанкционированного доступа к AI API

### 6.3 Ограничения
- **Длина истории:** Без ограничений в интерфейсе (ограничено моделью AI)
- **Количество сценариев:** Без ограничений
- **Частота запросов:** Ограничено только AI API

---

## 7. ЭТАПЫ РАЗРАБОТКИ

### Этап 1: Базовая настройка
- [x] Инициализация Next.js проекта с TypeScript
- [x] Настройка Tailwind CSS и shadcn/ui
- [x] Подключение Supabase

### Этап 2: Аутентификация
- [x] Настройка Supabase Auth
- [x] Создание страниц входа/регистрации
- [x] Защита приватных маршрутов

### Этап 3: Основной функционал
- [x] Создание формы ввода истории
- [x] Интеграция с AI моделью
- [x] Страница отображения результатов

### Этап 4: База данных
- [x] Создание схемы БД в Supabase
- [x] Сохранение историй и сценариев
- [x] Личный кабинет пользователя

### Этап 5: Чат-интерфейс
- [x] Разработка компонента чата
- [x] Интеграция с AI для контекстного взаимодействия
- [x] Сохранение истории чата

### Этап 6: Деплой и тестирование
- [x] Деплой на Vercel
- [x] Тестирование функционала
- [x] Мобильная оптимизация

---

## 8. ВОПРОСЫ ДЛЯ УТОЧНЕНИЯ

1. **Дополнительные функции:** Планируется ли добавление возможности экспорта сценариев в различные форматы (PDF, DOCX)?
2. **Модерация контента:** Требуется ли система модерации для проверки пользовательского контента и сгенерированных сценариев?
3. **Мультиязычность:** Планируется ли поддержка других языков кроме русского?
